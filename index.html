<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>^_^</title>
  <style>
    body {
      color: #ccc;
      margin: 0;
      padding: 0;
      font-family: Arial, Verdana, sans-serif;
      background-color: #000;
    }

    div {
      position: relative;
    }
  </style>
  <script src="phaser.min.js"></script>
</head>
<body>
<div id="display"></div>
<script>
  var display = document.getElementById("display");
  display.style.marginLeft = window.innerWidth * 0.1 + "px";
  display.width = window.innerWidth * 0.8;
  display.height = window.innerHeight;

  var game = new Phaser.Game(display.width, display.height, Phaser.CANVAS, "display", { render: render });
  var ttl = 5;
  var particles = [];

  function render() {
    if (particles.length < 100 && Math.random() < 0.3)
      particles.push(particle());
    for (var p of particles)
      draw(p);
  }

  function reset(particle) {
    particle.start = game.time.totalElapsedSeconds();
    particle.hue = Math.random() * 60;
    particle.xSide = Math.random() >= 0.5 ? 1 : -1;
    particle.xOffset = Math.random() * display.width / 3;
    particle.green = Math.random() * 32 + 128;
  }

  function draw(particle) {
    var time = (game.time.totalElapsedSeconds() - particle.start) / ttl;
    if (time >= 1) {
      reset(particle);
      return;
    }
    particle.p.y = display.height * (1 - time);

    var t = (time * 2 - 1) * 6;
    var x = (Math.atan(t) + Math.PI / 2) / Math.PI;
    particle.p.x = game.world.centerX + x * particle.xSide * particle.xOffset;

    var color;
    if (time < 0.3)
      color = particle.green;
    else if (time < 0.4) {
      var k = (time - 0.3) / 0.1;
      color = 128 + (particle.hue - 128) * k;
    } else
      color = particle.hue;
    game.debug.geom(particle.p, "hsl(" + (color|0) + ", 100%, 50%)");
  }

  function particle() {
    var particle = {
      p: new Phaser.Circle(game.world.centerX, display.height, Math.random() * 64 + 64)
    };
    reset(particle);
    return particle;
  }
</script>
</body>
</html>